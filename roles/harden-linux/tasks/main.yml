---
# tasks file for harden-linux

# Set timezone (conditionally included)
- name: Include timezone tasks
  import_tasks: base.yml
  when: import_timezone | default(false)
    
# Tasks for User and Access Management (conditionally included)
#=======
- name: Set timezone
  community.general.timezone:
    name: "{{ timezone }}"
  become: true
- name: Disable root login via SSH
  lineinfile:
    path: "{{ ssh_config_path }}"
    regexp: '^PermitRootLogin'
    line: "PermitRootLogin {{ permit_root_login }}"
  notify:
    - Restart SSH
  when: import_user_access_management | default(false)
  become: true

# Tasks for Password Policies (conditionally included)
#=======
  become: true

# Tasks for Password Policies
- name: Enforce minimum password length in PAM
  lineinfile:
    path: "{{ pam_password_conf_path }}"
    regexp: '^password requisite pam_pwquality.so'
    line: 'password requisite pam_pwquality.so minlen={{ min_password_length }}'
  when: import_password_policies | default(false)
  become: true

- name: Enforce max repeat characters in PAM
  lineinfile:
    path: "{{ pam_password_conf_path }}"
    regexp: '^password requisite pam_pwquality.so'
    line: 'password requisite pam_pwquality.so minlen={{ min_password_length }} maxrepeat={{ max_repeat_characters }}'
  when: import_password_policies | default(false)
  become: true

- name: Include service management tasks
  import_tasks: service_management.yml
  when: include_service_management | default(false)

- name: Include network security tasks
  import_tasks: network_security.yml
  when: include_network_security | default(false)

- name: Include service management tasks
  import_tasks: service_management.yml
  when: include_service_management | default(false)  

- name: Include network security tasks
  import_tasks: network_security.yml
  when: include_network_security | default(false) 

- name: Include file permissions tasks
  import_tasks: file_permissions.yml
  when: include_file_permissions | default(false)
#>>>>>>> backup-branch

- name: Include system auditing tasks
  import_tasks: system_auditing.yml
  when: include_system_auditing | default(false)

- name: Include kernel os hardening  tasks
  import_tasks: kernel_os_hardening.yml 
  when: include_kernel_os_hardening | default(false)


- name: Include advanced security  tasks
  import_tasks: advanced_security.yml
  when: include_advanced_security | default(false)

- name: Include compliance  tasks
  import_tasks: compliance.yml
  when: include_compliance | default(false)

- name: Include automatedupdates tasks
  import_tasks: automated_updates.yml
  when: include_automated_updates | default(false)

